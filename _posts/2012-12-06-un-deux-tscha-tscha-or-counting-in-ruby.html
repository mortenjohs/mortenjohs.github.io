---
layout: post
title: Un, deux, tscha-tscha - or Counting in Ruby
date: '2012-12-06T23:00:00.001+01:00'
author: Morten
tags:
- Programming
- functional
- Ruby
modified_time: '2020-04-25T17:31:50.309+02:00'
blogger_id: tag:blogger.com,1999:blog-6967032375013519080.post-4577171300455405331
blogger_orig_url: https://m635j520.blogspot.com/2012/12/un-deux-tscha-tscha-or-counting-in-ruby.html
---

<a href="http://www.flickr.com/photos/mortenjohs/8197744930/" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;" title="Gabriel på løvfest by mortenjohs, on Flickr"><img alt="Gabriel på løvfest" height="500" src="https://farm9.staticflickr.com/8205/8197744930_c25f1b029f.jpg" width="332"></a>Inspired by my little son's eagerness to count when he sees groups of things that (he thinks) can be grouped together these days, I wanted to post my often used, tiny, fairly naïve extension to Ruby's <span style="font-family: Courier New, Courier, monospace;">Array</span> class that I call <span style="font-family: Courier New, Courier, monospace;">count_by</span>.<br /><br /><script src="https://gist.github.com/mortenjohs/4228346.js"></script>This might not be the most beautiful way to solve this, but it is fairly readable and is leveraging some key aspects of the Ruby language - open classes, or monkey patching if you must, and dynamic calling of functions.<br /><br />Basically I open up the class <span style="font-family: Courier New, Courier, monospace;">Array</span> and add a <span style="font-family: Courier New, Courier, monospace;">count_by</span> function to it - that takes as argument the name of the function one wants to count the elements by.<br /><br />The function itself starts off by instantiating a <span style="font-family: Courier New, Courier, monospace;">Hash</span>, called <span style="font-family: Courier New, Courier, monospace;">map</span>, with default values of 0. For each element in the <span style="font-family: Courier New, Courier, monospace;">Array</span> I then call the function by the name provided&nbsp;and increments the &nbsp;entry in <span style="font-family: Courier New, Courier, monospace;">map</span>&nbsp;corresponding to the result.<br /><br />Like this, if I have a array of, let's say&nbsp;Olympic&nbsp;medalist&nbsp;objects with functions nationality in <span style="font-family: Courier New, Courier, monospace;">list</span>, I can easily say:&nbsp;<span style="font-family: Courier New, Courier, monospace;">list.count_by(:nationality)</span>&nbsp;and get back number of medalists per nationality.<br /><br />I guess a(n even) more Ruby way of implementing this would be as a mix of <span style="font-family: Courier New, Courier, monospace;">group_by</span> and <span style="font-family: Courier New, Courier, monospace;">map</span>, and another improvement could be to add <span style="font-family: Courier New, Courier, monospace;">count_by</span> to the class <span style="font-family: Courier New, Courier, monospace;">Enumerable</span> instead of <span style="font-family: Courier New, Courier, monospace;">Array</span>. Come to think of it, to make this function more in line with <span style="font-family: Courier New, Courier, monospace;">group_by</span>, I guess I should also rewrite it to take a block as an argument instead of just a function name.<br /><br />OK. Something like this, then:<br /><br /><script src="https://gist.github.com/mortenjohs/4228838.js"></script><br />I wouldn't call it more readable, maybe, but arguably more elegant - and way more flexible. Now one can count the nationalities from the example above by: <span style="font-family: Courier New, Courier, monospace;">list.count_by {&amp;:nationality}</span>